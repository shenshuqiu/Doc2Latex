# Doc2LaTeX 语法规则书

## 概述

Doc2LaTeX 是一个将 Word 文档转换为 LaTeX 格式的工具，支持多种自定义语法标记。所有语法均使用中文方括号 【】 包围。

## 基础语法规则

### 1. 文档结构语法

#### 1.1 章节标题语法

**小标题**
- 语法：`【小标题】文本内容` 或 `【小标题：标题内容】`
- 效果：生成带编号的蓝色大标题，自动递增编号
- 示例：
  ```
  【小标题】锻炼的重要性
  【小标题：运动前的准备工作】
  ```
- LaTeX 输出：
  ```latex
  \vspace{1ex}
  \textbf{\textcolor{blue-deep}{\large \arabic{little_title}、锻炼的重要性}}
  \par
  \refstepcounter{little_title}
  \vspace{1ex}
  ```

**小小标题**
- 语法：`【小小标题】文本内容` 或 `【小小标题：标题内容】`
- 效果：生成较小的蓝色副标题，无编号
- 示例：
  ```
  【小小标题】注意事项
  【小小标题：动作要领】
  ```
- LaTeX 输出：
  ```latex
  \vspace{0.4ex}
  \textbf{\textcolor{blue-deep}{ 注意事项}}
  \par
  \vspace{0.4ex}
  ```

### 2. 文本格式语法

#### 2.1 加粗语法

**标准加粗语法**
- 语法：`【加粗：文本内容】` 或 `【加粗:文本内容】`
- 效果：将文本显示为蓝色加粗
- 示例：
  ```
  这是【加粗：重要内容】的说明。
  请注意【加粗:安全事项】。
  ```
- LaTeX 输出：
  ```latex
  \textbf{\textcolor{blue}{重要内容}}
  ```

**默认加粗语法（简化语法）**
- 语法：`【文本内容】`（不包含冒号分隔符）
- 效果：等同于【加粗：文本内容】
- 示例：
  ```
  这是【重要内容】的说明。
  请注意【安全事项】。
  ```
- LaTeX 输出：
  ```latex
  \textbf{\textcolor{blue}{重要内容}}
  ```

#### 2.2 特殊字符处理

系统自动处理以下特殊字符：

| 原字符 | LaTeX 输出 | 说明 |
|--------|------------|------|
| % | \% | 百分号转义 |
| × | $\times$ | 乘号 |
| ≤ | $\le$ | 小于等于 |
| ≥ | $\ge$ | 大于等于 |
| ÷ | $\div$ | 除号 |
| ≈ | $\approx$ | 约等于 |
| ° | $^{\circ}$ | 度数符号 |
| -> | $\rightarrow$ | 右箭头 |
| <- | $\leftarrow$ | 左箭头 |
| ℃ | $^{\circ}$C | 摄氏度 |
| ~ | $\sim$ | 波浪号 |
| & | \& | 与符号转义 |

### 3. 图片插入语法

#### 3.1 图片语法
- 语法：`【图片：图片名称】`
- 效果：插入指定图片，自动添加标题和标签
- 图片格式：支持 jpg、JPG、png、PNG、jpeg、JPEG
- 图片路径：`data/assets/image/` 目录
- 示例：
  ```
  【图片：锻炼动作示意图】
  【图片：器材使用方法】后面的文字会作为图片标题
  ```
- LaTeX 输出：
  ```latex
  \begin{figure}[htbp]
  \centering
  \includegraphics[width=10cm]{../../data/assets/image/锻炼动作示意图.jpg}
  \caption{锻炼动作示意图}
  \label{锻炼动作示意图}
  \end{figure}
  ```

#### 3.2 图片引用语法
- 语法：`【引用：图片名称】`
- 效果：生成图片引用链接
- 示例：
  ```
  如【引用：锻炼动作示意图】所示...
  ```
- LaTeX 输出：
  ```latex
  图\ref{锻炼动作示意图}
  ```

### 4. 列表语法

#### 4.1 无序列表
- 语法：`【无序列表】项目1;项目2;项目3`
- 别名：`【项目符号列表】`、`【列表】`
- 分隔符：分号（;）或中文分号（；）
- 示例：
  ```
  运动前准备：
  【无序列表】热身运动;穿合适的运动服;准备足够的水
  ```
- LaTeX 输出：
  ```latex
  \begin{itemize}
  \item 热身运动
  \item 穿合适的运动服
  \item 准备足够的水
  \end{itemize}
  ```

#### 4.2 有序列表
- 语法：`【有序列表】步骤1;步骤2;步骤3`
- 别名：`【数字列表】`、`【编号列表】`
- 分隔符：分号（;）或中文分号（；）
- 示例：
  ```
  锻炼步骤：
  【有序列表】准备动作;开始锻炼;放松运动
  ```
- LaTeX 输出：
  ```latex
  \begin{enumerate}
  \item 准备动作
  \item 开始锻炼
  \item 放松运动
  \end{enumerate}
  ```

### 5. 模块框语法

#### 5.1 彩色模块框
- 语法：`【模块名称】模块内容` 或 `【模块名称：标题】模块内容`
- 支持的模块类型：
  - `【编者的话】` - 红色框
  - `【注意】` - 橙色框
  - `【提示】` - 绿色框
  - 其他自定义模块名

- 示例：
  ```
  【编者的话】本章节重点介绍基础锻炼方法。

  【注意：安全提醒】运动时请注意安全防护。

  【提示】每日坚持锻炼30分钟效果更佳。
  ```

- LaTeX 输出：
  ```latex
  \begin{module}[colback=redback,colframe=red,colbacktitle=red]{编者的话}
  本章节重点介绍基础锻炼方法。
  \end{module}
  ```

### 6. 换行和段落语法

#### 6.1 换行语法
- 语法：`【换行】`
- 效果：强制换行
- 示例：
  ```
  第一行内容【换行】第二行内容
  ```
- LaTeX 输出：
  ```latex
  第一行内容\\par
  第二行内容
  ```

#### 6.2 双斜杠换行
- 语法：`//`（非URL中的双斜杠）
- 效果：自动转换为换行
- 示例：
  ```
  第一段内容//第二段内容
  ```

### 7. 引用和链接语法

#### 7.1 标签引用
- 语法：`【引用：标签名】`
- 效果：生成交叉引用
- 示例：
  ```
  详见【引用：锻炼方法章节】
  ```

#### 7.2 网址链接
- 自动识别：`http://`、`https://`、`www.` 开头的网址
- 效果：自动转换为LaTeX的url格式
- 示例：
  ```
  参考网站：https://example.com
  ```
- LaTeX 输出：
  ```latex
  \url{https://example.com}
  ```

### 8. 高级语法特性

#### 8.1 语法嵌套
- 支持在模块框内使用加粗语法
- 支持在列表项中使用加粗语法
- 示例：
  ```
  【编者的话】这里有【重要提醒】需要注意。
  
  【无序列表】【热身】是必要的;【拉伸】要充分;【休息】要适当
  ```

#### 8.2 错误处理和建议
当遇到未识别的语法时，系统会提供智能建议：

- 包含"标题"的语法：建议使用【小标题】或【小小标题】
- 包含"弹力带"或"髋关节"的语法：建议使用【加粗：内容】
- "小标退"错误：提示应为【小标题】
- 其他情况：提供通用语法建议

#### 8.3 文档映射功能
- 支持文件名重映射（如 9-3-2 映射为 4-3-2）
- 错误报告显示格式：`4-3-2(原9-3-2)`
- 保持原始文件名追踪

## 语法优先级和解析规则

### 1. 解析顺序
1. 特殊字符替换（%、×、≤ 等）
2. 加粗语法处理（【加粗：】和【加粗：】）
3. 网址识别和转换
4. 术语字典替换
5. 自定义语法解析（图片、标题、列表等）
6. 默认加粗处理（无冒号的【】语法）

### 2. 语法冲突处理
- 有冒号的语法优先于默认加粗
- 图片语法优先于普通引用
- 特殊模块语法优先于普通文本

### 3. 容错机制
- 空内容的加粗语法将被忽略
- 不匹配的方括号会被报告
- 未找到的图片会抛出断言错误
- 未识别的语法提供建议并抛出错误

## 最佳实践建议

### 1. 文档编写建议
- 使用默认加粗语法【】可以简化编写
- 图片文件名不要包含特殊字符
- 列表项目使用分号分隔，避免在项目内容中使用分号
- 模块框内容较长时可以分段

### 2. 文件组织建议
- 按章节-节-小节格式命名文档（如：1-2-3.docx）
- 图片统一放置在各手册文件夹内
- 确保封面文件命名为 cover.pdf

### 3. 语法检查建议
- 确保【】方括号配对
- 避免在同一行使用过多嵌套语法
- 测试生成的 LaTeX 是否编译正确

## 技术实现细节

### 1. 语法解析器
- 基于正则表达式的递归解析
- 支持嵌套语法处理
- 错误位置精确定位

### 2. LaTeX 生成
- 使用 PyLaTeX 库生成结构化输出
- 支持中文字体配置
- 自动处理特殊字符转义

### 3. 图片处理
- 自动检测图片扩展名
- 支持多种图片格式
- 相对路径自动调整

### 4. 错误处理
- 详细的错误报告系统
- 智能语法建议
- 文件映射信息显示

---

*本语法规则书基于 Doc2LaTeX v1.0 系统，支持中文文档到 LaTeX 的高质量转换。*